package handlers

import (
	"testing"
	"yamul-gateway/internal/dtos/commands"
	"yamul-gateway/internal/interfaces/mocks"
)

func TestStatWindowInfo(t *testing.T) {
	type args struct {
		output  []byte
		command commands.StatWindowInfo
	}
	var tests = []struct {
		name string
		args args
	}{
		{
			name: "case minimal message",
			args: args{
				output: []byte{
					0x11, 0x00, 0x2B, 0x00, 0x00, 0x1F, 0xEF, 0x61,
					0x73, 0x64, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2D, 0x00,
					0x2D, 0x00, 0x00,
				},
				command: commands.StatWindowInfo{
					CharacterID:      0x00001fef,
					CharacterName:    "asdf",
					HitPointsCurrent: 45,
					HitPointsMax:     45,
					FlagNameAllowed:  false,
					FlagDisplay:      commands.FlagDisplay_minimal,
				},
			},
		},
		{
			name: "case normal message",
			args: args{
				output: []byte{
					0x11, 0x00, 0x40, 0x00, 0x00, 0x1F, 0xEF, 0x61,
					0x73, 0x64, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2D, 0x00,
					0x2D, 0x00, 0x01, 0x01, 0x11, 0x11, 0x22, 0x22,
					0x33, 0x33, 0x44, 0x44, 0x55, 0x55, 0x66, 0x66,
					0x77, 0x77, 0x77, 0x77, 0x88, 0x88, 0x99, 0x99,
				},
				command: commands.StatWindowInfo{
					CharacterID:        0x00001fef,
					CharacterName:      "asdf",
					HitPointsCurrent:   45,
					HitPointsMax:       45,
					FlagNameAllowed:    false,
					FlagDisplay:        commands.FlagDisplay_normal,
					Gender:             1,
					Strength:           0x1111,
					Intelligence:       0x2222,
					StaminaCurrent:     0x3333,
					StaminaMax:         0x4444,
					ManaCurrent:        0x5555,
					ManaMax:            0x6666,
					Gold:               0x77777777,
					ResistancePhysical: 0x8888,
					WeightCurrent:      0x9999,
				},
			},
		},
		{
			name: "case stats message",
			args: args{
				output: []byte{
					0x11, 0x00, 0x42, 0x00, 0x00, 0x1F, 0xEF, 0x61,
					0x73, 0x64, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2D, 0x00,
					0x2D, 0x00, 0x02, 0x01, 0x11, 0x11, 0x22, 0x22,
					0x33, 0x33, 0x44, 0x44, 0x55, 0x55, 0x66, 0x66,
					0x77, 0x77, 0x77, 0x77, 0x88, 0x88, 0x99, 0x99,
					0xAA, 0xAA,
				},
				command: commands.StatWindowInfo{
					CharacterID:        0x00001fef,
					CharacterName:      "asdf",
					HitPointsCurrent:   45,
					HitPointsMax:       45,
					FlagNameAllowed:    false,
					FlagDisplay:        commands.FlagDisplay_stats,
					Gender:             1,
					Strength:           0x1111,
					Intelligence:       0x2222,
					StaminaCurrent:     0x3333,
					StaminaMax:         0x4444,
					ManaCurrent:        0x5555,
					ManaMax:            0x6666,
					Gold:               0x77777777,
					ResistancePhysical: 0x8888,
					WeightCurrent:      0x9999,
					StatsCap:           0xAAAA,
				},
			},
		},
		{
			name: "case followers message",
			args: args{
				output: []byte{
					0x11, 0x00, 0x44, 0x00, 0x00, 0x1F, 0xEF, 0x61,
					0x73, 0x64, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2D, 0x00,
					0x2D, 0x00, 0x03, 0x01, 0x11, 0x11, 0x22, 0x22,
					0x33, 0x33, 0x44, 0x44, 0x55, 0x55, 0x66, 0x66,
					0x77, 0x77, 0x77, 0x77, 0x88, 0x88, 0x99, 0x99,
					0xAA, 0xAA, 0xBB, 0xCC,
				},
				command: commands.StatWindowInfo{
					CharacterID:        0x00001fef,
					CharacterName:      "asdf",
					HitPointsCurrent:   45,
					HitPointsMax:       45,
					FlagNameAllowed:    false,
					FlagDisplay:        commands.FlagDisplay_stats_followers,
					Gender:             1,
					Strength:           0x1111,
					Intelligence:       0x2222,
					StaminaCurrent:     0x3333,
					StaminaMax:         0x4444,
					ManaCurrent:        0x5555,
					ManaMax:            0x6666,
					Gold:               0x77777777,
					ResistancePhysical: 0x8888,
					WeightCurrent:      0x9999,
					StatsCap:           0xAAAA,
					FollowersCurrent:   0xBB,
					FollowersMax:       0xCC,
				},
			},
		},
		{
			name: "case followers and resistances message",
			args: args{
				output: []byte{
					0x11, 0x00, 0x56, 0x00, 0x00, 0x1F, 0xEF, 0x61,
					0x73, 0x64, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2D, 0x00,
					0x2D, 0x00, 0x04, 0x01, 0x11, 0x11, 0x22, 0x22,
					0x33, 0x33, 0x44, 0x44, 0x55, 0x55, 0x66, 0x66,
					0x77, 0x77, 0x77, 0x77, 0x88, 0x88, 0x99, 0x99,
					0xAA, 0xAA, 0xBB, 0xCC, 0xDD, 0xDD, 0xEE, 0xEE,
					0xFF, 0xFF, 0x10, 0x10, 0x20, 0x20, 0x30, 0x30,
					0x40, 0x40, 0x50, 0x50, 0x50, 0x50,
				},
				command: commands.StatWindowInfo{
					CharacterID:        0x00001fef,
					CharacterName:      "asdf",
					HitPointsCurrent:   45,
					HitPointsMax:       45,
					FlagNameAllowed:    false,
					FlagDisplay:        commands.FlagDisplay_stats_followers_resistances,
					Gender:             1,
					Strength:           0x1111,
					Intelligence:       0x2222,
					StaminaCurrent:     0x3333,
					StaminaMax:         0x4444,
					ManaCurrent:        0x5555,
					ManaMax:            0x6666,
					Gold:               0x77777777,
					ResistancePhysical: 0x8888,
					WeightCurrent:      0x9999,
					StatsCap:           0xAAAA,
					FollowersCurrent:   0xBB,
					FollowersMax:       0xCC,
					ResistanceFire:     0xDDDD,
					ResistanceCold:     0xEEEE,
					ResistancePoison:   0xFFFF,
					ResistanceEnergy:   0x1010,
					Luck:               0x2020,
					DamageMin:          0x3030,
					DamageMax:          0x4040,
					TithingPoints:      0x50505050,
				},
			},
		},
		{
			name: "case followers, resistances and weight message",
			args: args{
				output: []byte{
					0x11, 0x00, 0x59, 0x00, 0x00, 0x1F, 0xEF, 0x61,
					0x73, 0x64, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2D, 0x00,
					0x2D, 0x00, 0x05, 0x01, 0x11, 0x11, 0x22, 0x22,
					0x33, 0x33, 0x44, 0x44, 0x55, 0x55, 0x66, 0x66,
					0x77, 0x77, 0x77, 0x77, 0x88, 0x88, 0x99, 0x99,
					0x60, 0x60, 0x70, 0xAA, 0xAA, 0xBB, 0xCC, 0xDD,
					0xDD, 0xEE, 0xEE, 0xFF, 0xFF, 0x10, 0x10, 0x20,
					0x20, 0x30, 0x30, 0x40, 0x40, 0x50, 0x50, 0x50,
					0x50,
				},
				command: commands.StatWindowInfo{
					CharacterID:        0x00001fef,
					CharacterName:      "asdf",
					HitPointsCurrent:   45,
					HitPointsMax:       45,
					FlagNameAllowed:    false,
					FlagDisplay:        commands.FlagDisplay_stats_follwoers_resistances_weight,
					Gender:             1,
					Strength:           0x1111,
					Intelligence:       0x2222,
					StaminaCurrent:     0x3333,
					StaminaMax:         0x4444,
					ManaCurrent:        0x5555,
					ManaMax:            0x6666,
					Gold:               0x77777777,
					ResistancePhysical: 0x8888,
					WeightCurrent:      0x9999,
					StatsCap:           0xAAAA,
					FollowersCurrent:   0xBB,
					FollowersMax:       0xCC,
					ResistanceFire:     0xDDDD,
					ResistanceCold:     0xEEEE,
					ResistancePoison:   0xFFFF,
					ResistanceEnergy:   0x1010,
					Luck:               0x2020,
					DamageMin:          0x3030,
					DamageMax:          0x4040,
					TithingPoints:      0x50505050,
					WeightMax:          0x6060,
					Race:               0x70,
				},
			},
		},

		{
			name: "case full message",
			args: args{
				output: []byte{
					0x11, 0x00, 0x81, 0x00, 0x00, 0x1F, 0xEF, 0x61,
					0x73, 0x64, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2D, 0x00,
					0x2D, 0x00, 0x06, 0x01, 0x11, 0x11, 0x22, 0x22,
					0x33, 0x33, 0x44, 0x44, 0x55, 0x55, 0x66, 0x66,
					0x77, 0x77, 0x77, 0x77, 0x88, 0x88, 0x99, 0x99,
					0x60, 0x60, 0x70, 0xAA, 0xAA, 0xBB, 0xCC, 0xDD,
					0xDD, 0xEE, 0xEE, 0xFF, 0xFF, 0x10, 0x10, 0x20,
					0x20, 0x30, 0x30, 0x40, 0x40, 0x50, 0x50, 0x50,
					0x50, 0x80, 0x80, 0x90, 0x90, 0xA0, 0xA0, 0xB0,
					0xB0, 0xC0, 0xC0, 0xD0, 0xD0, 0xE0, 0xE0, 0xF0,
					0xF0, 0x01, 0x01, 0x02, 0x02, 0x03, 0x03, 0x04,
					0x04, 0x05, 0x05, 0x06, 0x06, 0x07, 0x07,
				},
				command: commands.StatWindowInfo{
					CharacterID:                  0x00001fef,
					CharacterName:                "asdf",
					HitPointsCurrent:             45,
					HitPointsMax:                 45,
					FlagNameAllowed:              false,
					FlagDisplay:                  commands.FlagDisplay_full_message,
					Gender:                       1,
					Strength:                     0x1111,
					Intelligence:                 0x2222,
					StaminaCurrent:               0x3333,
					StaminaMax:                   0x4444,
					ManaCurrent:                  0x5555,
					ManaMax:                      0x6666,
					Gold:                         0x77777777,
					ResistancePhysical:           0x8888,
					WeightCurrent:                0x9999,
					StatsCap:                     0xAAAA,
					FollowersCurrent:             0xBB,
					FollowersMax:                 0xCC,
					ResistanceFire:               0xDDDD,
					ResistanceCold:               0xEEEE,
					ResistancePoison:             0xFFFF,
					ResistanceEnergy:             0x1010,
					Luck:                         0x2020,
					DamageMin:                    0x3030,
					DamageMax:                    0x4040,
					TithingPoints:                0x50505050,
					WeightMax:                    0x6060,
					Race:                         0x70,
					ResistancePhysicalMax:        0x8080,
					ResistanceFireMax:            0x9090,
					ResistanceColdMax:            0xA0A0,
					ResistancePoisonMax:          0xB0B0,
					ResistanceEnergyMax:          0xC0C0,
					DefenseChanceIncreaseCurrent: 0xD0D0,
					DefenseChanceIncreaseMax:     0xE0E0,
					HitChanceIncrease:            0xF0F0,
					SwingSpeedIncrease:           0x0101,
					DamageIncrease:               0x0202,
					LowerReagentCost:             0x0303,
					SpellDamageIncrease:          0x0404,
					FasterCastRecovery:           0x0505,
					FasterCasting:                0x0606,
					LowerManaCost:                0x0707,
				},
			},
		},
		{
			name: "case real message",
			args: args{
				output: []byte{
					0x11, 0x00, 0x81, 0x00, 0x00, 0x1F, 0xEF, 0x61,
					0x73, 0x64, 0x66, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2D, 0x00,
					0x2D, 0x00, 0x06, 0x00, 0x00, 0x2D, 0x00, 0x23,
					0x00, 0x0A, 0x00, 0x23, 0x00, 0x23, 0x00, 0x0A,
					0x00, 0x0A, 0x00, 0x00, 0x03, 0xE8, 0x00, 0x00,
					0x00, 0x48, 0x00, 0xC5, 0x01, 0x01, 0x2C, 0x00,
					0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x04, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x46, 0x00, 0x46, 0x00,
					0x46, 0x00, 0x46, 0x00, 0x46, 0x00, 0x00, 0x00,
					0x2D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
					0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				},
				command: commands.StatWindowInfo{
					CharacterID:                  0x00001fef,
					CharacterName:                "asdf",
					HitPointsCurrent:             45,
					HitPointsMax:                 45,
					FlagNameAllowed:              false,
					FlagDisplay:                  commands.FlagDisplay_full_message,
					Gender:                       0,
					Strength:                     45,
					Intelligence:                 35,
					StaminaCurrent:               10,
					StaminaMax:                   35,
					ManaCurrent:                  35,
					ManaMax:                      10,
					Gold:                         655360,
					ResistancePhysical:           1000,
					WeightCurrent:                0,
					WeightMax:                    72,
					Race:                         0,
					StatsCap:                     50433,
					FollowersCurrent:             1,
					FollowersMax:                 44,
					ResistanceFire:               5,
					ResistanceCold:               0,
					ResistancePoison:             0,
					ResistanceEnergy:             0,
					Luck:                         0,
					DamageMin:                    0,
					DamageMax:                    1,
					TithingPoints:                262144,
					ResistancePhysicalMax:        0,
					ResistanceFireMax:            70,
					ResistanceColdMax:            70,
					ResistancePoisonMax:          70,
					ResistanceEnergyMax:          70,
					DefenseChanceIncreaseCurrent: 70,
					DefenseChanceIncreaseMax:     0,
					HitChanceIncrease:            45,
					SwingSpeedIncrease:           0,
					DamageIncrease:               0,
					LowerReagentCost:             0,
					SpellDamageIncrease:          0,
					FasterCastRecovery:           0,
					FasterCasting:                0,
					LowerManaCost:                0,
				},
			},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			client := mocks.CreateClientConnectionWriteBufferMock(t)
			StatWindowInfo(client, tt.args.command)
			client.AssertSentBuffer(tt.args.output)
		})
	}
}
